# 管理觉察测评报告生成系统

一个面向团队的在线报告生成工具：上传 Excel 一键生成管理觉察测评报告，支持丰富的可配置项（Banner、Logo、阅读说明、类型概述与八大类型详细分析），并支持每种类型独立二维码和多人共享配置。全流程在浏览器端完成渲染与导出，支持导出 HTML / PNG / JPG（单个/批量）。

---

## ✨ 功能特性

- **Excel 一键出报告**：上传多行 Excel，自动解析并按行生成报告
- **双环图可视化（总体结果）**
  - 外环（想明白/讲清楚/执行到位）、内环（管自己/管业务/管团队）
  - 按分数排名动态分配粗细（30/20/10），并调优角度分配
  - 标签显示名称 分数（如：讲清楚 90）
- **条形图分数标签**：每个柱条内顶部直接显示分数
- **8 种管理类型详细分析**
  - 每种类型可配置：标题、引语、头像、二维码、优势初衷、典型行为、潜在风险、发展建议
  - 附录中的二维码随主类型变化（已迁移至详细分析页逐类型上传）
- **多人共享配置**
  - 任何人保存共享后，其他人刷新即可自动同步
  - 服务端使用内存存储（JSON 上限 10MB）
- **导出**
  - 单份：HTML / PNG / JPG（浏览器本地生成）
  - 批量：针对多行 Excel 输出 ZIP 包含全部报告
- **UI 风格**：金山云蓝主题（#1890FF），专业、清爽

---

## 🧠 架构与数据流（简要）

- **前端（React + TypeScript, Vite 构建）**：
  - Excel 解析：FileReader + SheetJS（xlsx）在浏览器内存完成，不上传
  - 报告生成：前端 JS 完成排序/粗细/角度/主类型判定与渲染
  - 本地持久化：配置写入 localStorage（仅本机本浏览器有效）
  - 共享配置：用户点击保存为共享配置 将带图片 Data URL 的 JSON 发送服务端  其他用户刷新从 /api/config 拉取
- **服务端（Express）**：
  - 托管静态资源（dist）与 SPA 路由
  - 共享配置 API：使用内存保存最新配置（JSON 体积上限 10MB）

> 隐私：Excel 数据仅在本地解析；共享配置一旦保存将包含图片 Data URL，暂存在服务端内存（重启/重部署会清空）。

---

## 📁 目录结构（核心）

`
src/
  components/
    ConfigManager.tsx        # 配置页（含每类型头像/二维码上传）
    DoubleRingChart.tsx      # 双环图（标签显示名称 分数）
    ReportPreview.tsx        # 报告预览（条形图顶部分数 + 附录二维码随主类型变化）
  config/
    managementTypes.ts       # 8 种类型默认配置（含 qrCode 默认值）
  utils/
    excelParser.ts           # Excel 解析与格式校验
    dataProcessor.ts         # 数据处理、主类型判定、双环图数据
    exportUtils.ts           # 导出 HTML/PNG/JPG/批量 ZIP
    sharedConfigApi.ts       # 共享配置 API 封装（GET/POST /api/config）
  types/
    index.ts                 # TS 类型定义（ManagementTypeDetail 新增 qrCode）
server/
  index.js                   # Express 托管 dist + /api/config（JSON 上限 10MB）
public/
  logo.png banner.png avatar.png qrcode.png  # 默认静态资源
`

---

## 🛠 快速开始（本地）

1) 安装依赖
`
npm install
`
2) 启动开发
`
npm run dev
`
3) 生产构建
`
npm run build
`
4) 启动生产服务（使用 Express 托管 dist + API）
`
npm start
# 打开 http://localhost:3000
`

---

## 🧑‍🏫 网站使用说明

### 1. 数据上传
- 打开数据上传，选择包含以下字段的 Excel：
  - 姓名、日期、想明白、讲清楚、执行到位、管自己、管业务、管团队
  - 劳模型、好人型、严师型、布置型、隐身型、黄牛型、军师型、内敛型
- 成功解析后自动进入报告预览。

### 2. 配置管理
- **基础配置**：上传 Banner / Logo，编辑附录文字
- **阅读说明**：编辑 3 条原则
- **类型概述**：编辑 8 种类型的名称 + 定义
- **详细分析（重点）**：
  - 在顶部选择一个类型（如劳模型）
  - 配置标题 / 引语 / 头像 / 二维码 / 四段文字
  - 二维码：此处上传后，预览页附录将随主类型切换对应二维码
- **附录**：仅保留附录文字；二维码已迁至详细分析逐类型配置
- **保存共享**：在附录页右下角点击保存为共享配置（全站生效），其他用户刷新即可同步

### 3. 报告预览（核心可视化）
- **总体结果**：
  - 双环图（胜任力外环 + 管理维度内环），按排名自动分配粗细；标签显示名称 分数
  - 条形图（八种类型得分），每个柱条内顶部显示分数
- **详细结果**：按主类型展示对应文案、头像与该类型二维码
- **附录**：展示当前主类型的二维码；若该类型未配置，回退到基础配置二维码

### 4. 导出
- 单个导出：HTML / PNG / JPG（均在浏览器本地生成）
- 批量导出：Excel 多行数据可统一导出（ZIP）

---

## 📐 Excel 模板示例

`
姓名    日期          想明白  讲清楚  执行到位  管自己  管业务  管团队  劳模型  好人型  严师型  布置型  隐身型  黄牛型  军师型  内敛型
张三    2025/10/09    89     82     85       88     86     85     85     55     45     35     40     50     65     45
李四    2025/10/10    75     88     72       80     85     78     50     75     40     30     35     60     70     55
`

> 日期支持 Excel 序列号与 YYYY/MM/DD（或 YYYY-MM-DD）格式，系统会自动转换。

---

## ❓ 常见问题（FAQ）

- 导出图片样式与页面存在差异？
  - 已在 SVG 标签中使用内联样式，html-to-image 设置了较高像素比；仍有差异请反馈具体页面场景。
- 为什么批量导出时页面会自动轮换？
  - 批量导出通过自动切换每份报告、渲染并打包 ZIP（JSZip）完成，请等待进度提示。
- 共享配置是否会丢失？
  - 当前为内存存储，服务重启或重新部署会清空。建议导出配置 JSON 或升级为对象存储/数据库。
- 8 张二维码是否会超内存/带宽？
  - 单图 100200KB，8 张约 12MB；后端 JSON 上限已为 10MB，通常足够。

---

## 🔒 安全与隐私

- Excel 数据：仅在浏览器本地解析与计算，不上传服务器
- 本地配置：保存在 localStorage，仅本机浏览器可见
- 共享配置：点击保存共享后将带图片 Data URL 的 JSON 存在服务端内存（上限 10MB）
- 默认图片：/logo.png、/banner.png、/avatar.png、/qrcode.png 来自 public/，所有访问者可见

> 若需企业级持久化与权限控制：可接入对象存储（R2/S3）与数据库（Postgres/Redis），并添加鉴权。

---

## 🧭 未来路线

- 对象存储接入：上传图片改为 URL 引用，压缩优化，CDN 加速
- 配置持久化：Postgres/Redis，支持版本/审计/权限
- PDF 导出 / 模板多样化 / 国际化

---

## License

MIT
